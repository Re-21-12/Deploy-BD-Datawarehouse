<?xml version="1.0" encoding="UTF-8"?>
<pipeline>
  <info>
    <name>fix</name>
    <name_sync_with_filename>Y</name_sync_with_filename>
    <description>Pipeline ETL completo para Data Warehouse de Clima</description>
    <extended_description/>
    <pipeline_version/>
    <pipeline_type>Normal</pipeline_type>
    <parameters>
    </parameters>
    <capture_transform_performance>N</capture_transform_performance>
    <transform_performance_capturing_delay>1000</transform_performance_capturing_delay>
    <transform_performance_capturing_size_limit>100</transform_performance_capturing_size_limit>
    <created_user>-</created_user>
    <created_date>2025/05/27 10:00:00.000</created_date>
    <modified_user>-</modified_user>
    <modified_date>2025/05/27 10:00:00.000</modified_date>
  </info>
  <notepads>
  </notepads>
  <order>
    <hop>
      <from>Table input</from>
      <to>Data validation</to>
      <enabled>Y</enabled>
    </hop>
    <hop>
      <from>Data validation</from>
      <to>DateTime Lookup</to>
      <enabled>Y</enabled>
    </hop>
    <hop>
      <from>DateTime Lookup</from>
      <to>Condition Lookup</to>
      <enabled>Y</enabled>
    </hop>
    <hop>
      <from>Condition Lookup</from>
      <to>Station Lookup</to>
      <enabled>Y</enabled>
    </hop>
    <hop>
      <from>Station Lookup</from>
      <to>Location Lookup</to>
      <enabled>Y</enabled>
    </hop>
    <hop>
      <from>Location Lookup</from>
      <to>Final Field Selection</to>
      <enabled>Y</enabled>
    </hop>
    <hop>
      <from>Final Field Selection</from>
      <to>Final Filter</to>
      <enabled>Y</enabled>
    </hop>
    <hop>
      <from>Final Filter</from>
      <to>WeatherFacts Output</to>
      <enabled>Y</enabled>
    </hop>
  </order>
  
  <transform>
    <name>Table input</name>
    <type>TableInput</type>
    <description>Lee datos del staging</description>
    <distribute>Y</distribute>
    <custom_distribution/>
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name/>
    </partitioning>
    <connection>postgress-datawarehouse</connection>
    <execute_each_row>N</execute_each_row>
    <limit>0</limit>
    <sql>SELECT 
      datetime,
      tempmax,
      tempmin,
      temp,
      feelslikemax,
      feelslikemin,
      feelslike,
      dew,
      humidity,
      precipt,
      precipprob,
      precipcover,
      preciptype,
      snow,
      snowdepth,
      windgust,
      windspeed,
      winddir,
      sealevelpressure,
      cloudcover,
      visibility,
      solarradiation,
      solarenergy,
      uvindex,
      severerisk,
      moonphase,
      conditions,
      description,
      icon,
      stations,
      departamento
    FROM staging.clima
    WHERE datetime IS NOT NULL;</sql>
    <variables_active>N</variables_active>
    <attributes/>
    <GUI>
      <xloc>96</xloc>
      <yloc>144</yloc>
    </GUI>
  </transform>

  <transform>
    <name>Data validation</name>
    <type>FilterRows</type>
    <description>Valida datos básicos</description>
    <distribute>Y</distribute>
    <custom_distribution/>
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name/>
    </partitioning>
    <compare>
      <condition>
        <conditions>
          <condition>
            <conditions>
            </conditions>
            <function>IS NOT NULL</function>
            <leftvalue>datetime</leftvalue>
            <negated>N</negated>
            <operator>-</operator>
          </condition>
          <condition>
            <conditions>
            </conditions>
            <function>IS NOT NULL</function>
            <leftvalue>conditions</leftvalue>
            <negated>N</negated>
            <operator>AND</operator>
          </condition>
          <condition>
            <conditions>
            </conditions>
            <function>IS NOT NULL</function>
            <leftvalue>stations</leftvalue>
            <negated>N</negated>
            <operator>AND</operator>
          </condition>
          <condition>
            <conditions>
            </conditions>
            <function>IS NOT NULL</function>
            <leftvalue>departamento</leftvalue>
            <negated>N</negated>
            <operator>AND</operator>
          </condition>
        </conditions>
        <function>IS NOT NULL</function>
        <leftvalue>datetime</leftvalue>
        <negated>N</negated>
        <operator>-</operator>
      </condition>
    </compare>
    <send_true_to>DateTime Lookup</send_true_to>
    <attributes/>
    <GUI>
      <xloc>200</xloc>
      <yloc>144</yloc>
    </GUI>
  </transform>

  <transform>
    <name>DateTime Lookup</name>
    <type>StreamLookup</type>
    <description>Busca datetime_id en DimDateTime</description>
    <distribute>Y</distribute>
    <custom_distribution/>
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name/>
    </partitioning>
    <connection>postgress-datawarehouse</connection>
    <cache>N</cache>
    <cache_load_all>N</cache_load_all>
    <cache_size>0</cache_size>
    <lookup>
      <schema>dw</schema>
      <table>"DimDateTime"</table>
      <orderby/>
      <fail_on_multiple>N</fail_on_multiple>
      <eat_row_on_failure>N</eat_row_on_failure>
      <key>
        <name>datetime</name>
        <field>datetime</field>
        <condition>=</condition>
      </key>
      <value>
        <name>id</name>
        <rename>datetime_id</rename>
        <default>-1</default>
        <type>Integer</type>
      </value>
    </lookup>
    <attributes/>
    <GUI>
      <xloc>320</xloc>
      <yloc>144</yloc>
    </GUI>
  </transform>

  <transform>
    <name>Condition Lookup</name>
    <type>StreamLookup</type>
    <description>Busca condition_id en DimCondition</description>
    <distribute>Y</distribute>
    <custom_distribution/>
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name/>
    </partitioning>
    <connection>postgress-datawarehouse</connection>
    <cache>N</cache>
    <cache_load_all>N</cache_load_all>
    <cache_size>0</cache_size>
    <lookup>
      <schema>dw</schema>
      <table>"DimCondition"</table>
      <orderby/>
      <fail_on_multiple>N</fail_on_multiple>
      <eat_row_on_failure>N</eat_row_on_failure>
      <key>
        <name>conditions</name>
        <field>condition</field>
        <condition>=</condition>
      </key>
      <value>
        <name>id</name>
        <rename>condition_id</rename>
        <default>-1</default>
        <type>Integer</type>
      </value>
    </lookup>
    <attributes/>
    <GUI>
      <xloc>440</xloc>
      <yloc>144</yloc>
    </GUI>
  </transform>

  <transform>
    <name>Station Lookup</name>
    <type>StreamLookup</type>
    <description>Busca station_id en DimStation</description>
    <distribute>Y</distribute>
    <custom_distribution/>
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name/>
    </partitioning>
    <connection>postgress-datawarehouse</connection>
    <cache>N</cache>
    <cache_load_all>N</cache_load_all>
    <cache_size>0</cache_size>
    <lookup>
      <schema>dw</schema>
      <table>"DimStation"</table>
      <orderby/>
      <fail_on_multiple>N</fail_on_multiple>
      <eat_row_on_failure>N</eat_row_on_failure>
      <key>
        <name>stations</name>
        <field>code</field>
        <condition>=</condition>
      </key>
      <value>
        <name>id</name>
        <rename>station_id</rename>
        <default>-1</default>
        <type>Integer</type>
      </value>
    </lookup>
    <attributes/>
    <GUI>
      <xloc>560</xloc>
      <yloc>144</yloc>
    </GUI>
  </transform>

  <transform>
    <name>Location Lookup</name>
    <type>StreamLookup</type>
    <description>Busca location_id en DimLocation</description>
    <distribute>Y</distribute>
    <custom_distribution/>
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name/>
    </partitioning>
    <connection>postgress-datawarehouse</connection>
    <cache>N</cache>
    <cache_load_all>N</cache_load_all>
    <cache_size>0</cache_size>
    <lookup>
      <schema>dw</schema>
      <table>"DimLocation"</table>
      <orderby/>
      <fail_on_multiple>N</fail_on_multiple>
      <eat_row_on_failure>N</eat_row_on_failure>
      <key>
        <name>departamento</name>
        <field>name</field>
        <condition>=</condition>
      </key>
      <value>
        <name>id</name>
        <rename>location_id</rename>
        <default>-1</default>
        <type>Integer</type>
      </value>
    </lookup>
    <attributes/>
    <GUI>
      <xloc>680</xloc>
      <yloc>144</yloc>
    </GUI>
  </transform>

  <transform>
    <name>Final Field Selection</name>
    <type>SelectValues</type>
    <description>Selecciona y renombra campos finales</description>
    <distribute>Y</distribute>
    <custom_distribution/>
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name/>
    </partitioning>
    <fields>
      <field>
        <length>-2</length>
        <name>datetime_id</name>
        <precision>-2</precision>
      </field>
      <field>
        <length>-2</length>
        <name>condition_id</name>
        <precision>-2</precision>
      </field>
      <field>
        <length>-2</length>
        <name>station_id</name>
        <precision>-2</precision>
      </field>
      <field>
        <length>-2</length>
        <name>location_id</name>
        <precision>-2</precision>
      </field>
      <field>
        <length>-2</length>
        <name>tempmax</name>
        <precision>-2</precision>
        <rename>temp_max</rename>
      </field>
      <field>
        <length>-2</length>
        <name>tempmin</name>
        <precision>-2</precision>
        <rename>temp_min</rename>
      </field>
      <field>
        <length>-2</length>
        <name>temp</name>
        <precision>-2</precision>
        <rename>temp_avg</rename>
      </field>
      <field>
        <length>-2</length>
        <name>feelslikemax</name>
        <precision>-2</precision>
        <rename>feelslike_max</rename>
      </field>
      <field>
        <length>-2</length>
        <name>feelslikemin</name>
        <precision>-2</precision>
        <rename>feelslike_min</rename>
      </field>
      <field>
        <length>-2</length>
        <name>feelslike</name>
        <precision>-2</precision>
        <rename>feelslike_avg</rename>
      </field>
      <field>
        <length>-2</length>
        <name>dew</name>
        <precision>-2</precision>
        <rename>dew_point</rename>
      </field>
      <field>
        <length>-2</length>
        <name>humidity</name>
        <precision>-2</precision>
      </field>
      <field>
        <length>-2</length>
        <name>precipt</name>
        <precision>-2</precision>
        <rename>precip</rename>
      </field>
      <field>
        <length>-2</length>
        <name>precipprob</name>
        <precision>-2</precision>
        <rename>precip_prob</rename>
      </field>
      <field>
        <length>-2</length>
        <name>precipcover</name>
        <precision>-2</precision>
        <rename>precip_cover</rename>
      </field>
      <field>
        <length>-2</length>
        <name>snow</name>
        <precision>-2</precision>
      </field>
      <field>
        <length>-2</length>
        <name>snowdepth</name>
        <precision>-2</precision>
        <rename>snow_depth</rename>
      </field>
      <field>
        <length>-2</length>
        <name>windgust</name>
        <precision>-2</precision>
        <rename>wind_gust</rename>
      </field>
      <field>
        <length>-2</length>
        <name>windspeed</name>
        <precision>-2</precision>
        <rename>wind_speed</rename>
      </field>
      <field>
        <length>-2</length>
        <name>winddir</name>
        <precision>-2</precision>
        <rename>wind_dir</rename>
      </field>
      <field>
        <length>-2</length>
        <name>sealevelpressure</name>
        <precision>-2</precision>
        <rename>pressure</rename>
      </field>
      <field>
        <length>-2</length>
        <name>cloudcover</name>
        <precision>-2</precision>
        <rename>cloud_cover</rename>
      </field>
      <field>
        <length>-2</length>
        <name>visibility</name>
        <precision>-2</precision>
      </field>
      <field>
        <length>-2</length>
        <name>solarradiation</name>
        <precision>-2</precision>
        <rename>solar_radiation</rename>
      </field>
      <field>
        <length>-2</length>
        <name>solarenergy</name>
        <precision>-2</precision>
        <rename>solar_energy</rename>
      </field>
      <field>
        <length>-2</length>
        <name>uvindex</name>
        <precision>-2</precision>
        <rename>uv_index</rename>
      </field>
      <field>
        <length>-2</length>
        <name>severerisk</name>
        <precision>-2</precision>
        <rename>severe_risk</rename>
      </field>
      <field>
        <length>-2</length>
        <name>moonphase</name>
        <precision>-2</precision>
        <rename>moon_phase</rename>
      </field>
      <select_unspecified>N</select_unspecified>
    </fields>
    <attributes/>
    <GUI>
      <xloc>800</xloc>
      <yloc>144</yloc>
    </GUI>
  </transform>

  <transform>
    <name>Final Filter</name>
    <type>FilterRows</type>
    <description>Filtro final para datos válidos</description>
    <distribute>Y</distribute>
    <custom_distribution/>
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name/>
    </partitioning>
    <compare>
      <condition>
        <conditions>
          <condition>
            <conditions>
            </conditions>
            <function>&gt;</function>
            <leftvalue>datetime_id</leftvalue>
            <negated>N</negated>
            <operator>-</operator>
            <value>
              <isnull>N</isnull>
              <length>-1</length>
              <mask>###0;-###0</mask>
              <name>constant</name>
              <precision>0</precision>
              <text>0</text>
              <type>Integer</type>
            </value>
          </condition>
          <condition>
            <conditions>
            </conditions>
            <function>&gt;</function>
            <leftvalue>condition_id</leftvalue>
            <negated>N</negated>
            <operator>AND</operator>
            <value>
              <isnull>N</isnull>
              <length>-1</length>
              <mask>###0;-###0</mask>
              <name>constant</name>
              <precision>0</precision>
              <text>0</text>
              <type>Integer</type>
            </value>
          </condition>
          <condition>
            <conditions>
            </conditions>
            <function>&gt;</function>
            <leftvalue>station_id</leftvalue>
            <negated>N</negated>
            <operator>AND</operator>
            <value>
              <isnull>N</isnull>
              <length>-1</length>
              <mask>###0;-###0</mask>
              <name>constant</name>
              <precision>0</precision>
              <text>0</text>
              <type>Integer</type>
            </value>
          </condition>
          <condition>
            <conditions>
            </conditions>
            <function>&gt;</function>
            <leftvalue>location_id</leftvalue>
            <negated>N</negated>
            <operator>AND</operator>
            <value>
              <isnull>N</isnull>
              <length>-1</length>
              <mask>###0;-###0</mask>
              <name>constant</name>
              <precision>0</precision>
              <text>0</text>
              <type>Integer</type>
            </value>
          </condition>
        </conditions>
        <function>&gt;</function>
        <leftvalue>datetime_id</leftvalue>
        <negated>N</negated>
        <operator>-</operator>
        <value>
          <isnull>N</isnull>
          <length>-1</length>
          <mask>###0;-###0</mask>
          <name>constant</name>
          <precision>0</precision>
          <text>0</text>
          <type>Integer</type>
        </value>
      </condition>
    </compare>
    <send_true_to>WeatherFacts Output</send_true_to>
    <attributes/>
    <GUI>
      <xloc>920</xloc>
      <yloc>144</yloc>
    </GUI>
  </transform>

  <transform>
    <name>WeatherFacts Output</name>
    <type>TableOutput</type>
    <description>Inserta en tabla WeatherFacts</description>
    <distribute>Y</distribute>
    <custom_distribution/>
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name/>
    </partitioning>
    <commit>1000</commit>
    <connection>postgress-datawarehouse</connection>
    <fields>
      <field>
        <column_name>datetime_id</column_name>
        <stream_name>datetime_id</stream_name>
      </field>
      <field>
        <column_name>condition_id</column_name>
        <stream_name>condition_id</stream_name>
      </field>
      <field>
        <column_name>station_id</column_name>
        <stream_name>station_id</stream_name>
      </field>
      <field>
        <column_name>location_id</column_name>
        <stream_name>location_id</stream_name>
      </field>
      <field>
        <column_name>temp_max</column_name>
        <stream_name>temp_max</stream_name>
      </field>
      <field>
        <column_name>temp_min</column_name>
        <stream_name>temp_min</stream_name>
      </field>
      <field>
        <column_name>temp_avg</column_name>
        <stream_name>temp_avg</stream_name>
      </field>
      <field>
        <column_name>feelslike_max</column_name>
        <stream_name>feelslike_max</stream_name>
      </field>
      <field>
        <column_name>feelslike_min</column_name>
        <stream_name>feelslike_min</stream_name>
      </field>
      <field>
        <column_name>feelslike_avg</column_name>
        <stream_name>feelslike_avg</stream_name>
      </field>
      <field>
        <column_name>dew_point</column_name>
        <stream_name>dew_point</stream_name>
      </field>
      <field>
        <column_name>humidity</column_name>
        <stream_name>humidity</stream_name>
      </field>
      <field>
        <column_name>precip</column_name>
        <stream_name>precip</stream_name>
      </field>
      <field>
        <column_name>precip_prob</column_name>
        <stream_name>precip_prob</stream_name>
      </field>
      <field>
        <column_name>precip_cover</column_name>
        <stream_name>precip_cover</stream_name>
      </field>
      <field>
        <column_name>snow</column_name>
        <stream_name>snow</stream_name>
      </field>
      <field>
        <column_name>snow_depth</column_name>
        <stream_name>snow_depth</stream_name>
      </field>
      <field>
        <column_name>wind_gust</column_name>
        <stream_name>wind_gust</stream_name>
      </field>
      <field>
        <column_name>wind_speed</column_name>
        <stream_name>wind_speed</stream_name>
      </field>
      <field>
        <column_name>wind_dir</column_name>
        <stream_name>wind_dir</stream_name>
      </field>
      <field>
        <column_name>pressure</column_name>
        <stream_name>pressure</stream_name>
      </field>
      <field>
        <column_name>cloud_cover</column_name>
        <stream_name>cloud_cover</stream_name>
      </field>
      <field>
        <column_name>visibility</column_name>
        <stream_name>visibility</stream_name>
      </field>
      <field>
        <column_name>solar_radiation</column_name>
        <stream_name>solar_radiation</stream_name>
      </field>
      <field>
        <column_name>solar_energy</column_name>
        <stream_name>solar_energy</stream_name>
      </field>
      <field>
        <column_name>uv_index</column_name>
        <stream_name>uv_index</stream_name>
      </field>
      <field>
        <column_name>severe_risk</column_name>
        <stream_name>severe_risk</stream_name>
      </field>
      <field>
        <column_name>moon_phase</column_name>
        <stream_name>moon_phase</stream_name>
      </field>
    </fields>
    <ignore_errors>N</ignore_errors>
    <only_when_have_rows>N</only_when_have_rows>
    <partitioning_daily>N</partitioning_daily>
    <partitioning_enabled>N</partitioning_enabled>
    <partitioning_monthly>Y</partitioning_monthly>
    <return_keys>N</return_keys>
    <schema>dw</schema>
    <specify_fields>Y</specify_fields>
    <table>WeatherFacts</table>
    <tablename_in_field>N</tablename_in_field>
    <tablename_in_table>Y</tablename_in_table>
    <truncate>N</truncate>
    <use_batch>Y</use_batch>
    <attributes/>
    <GUI>
      <xloc>1040</xloc>
      <yloc>144</yloc>
    </GUI>
  </transform>

  <transform_error_handling>
  </transform_error_handling>
  <attributes/>
</pipeline>